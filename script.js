// WHITE

let WRook1 = {
    color: "W",
    type: "rook",
    position: [1, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_tour.svg",
}

let WRook2 = {
    color: "W",
    type: "rook",
    position: [8, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_tour.svg",
}  

let WPony1 = {
    color: "W",
    type: "pony",
    position: [2, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_poney.svg",
}

let WPony2 = {
    color: "W",
    type: "pony",
    position: [7, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_poney.svg",
}

let WBishop1 = {
    color: "W",
    type: "bishop",
    position: [3, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_fou.svg",
}

let WBishop2 = {
    color: "W",
    type: "bishop",
    position: [6, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_fou.svg",
}

let WQueen = {
    color: "W",
    type: "queen",
    position: [4, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_dame.svg",
}

let WKing = {
    color: "W",
    type: "king",
    position: [5, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_king.svg",
}

let WPawn1 = {
    color: "W",
    type: "pawn",
    position: [1, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn2 = {
    color: "W",
    type: "pawn",
    position: [2, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}
let WPawn3 = {
    color: "W",
    type: "pawn",
    position: [3, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn4 = {
    color: "W",
    type: "pawn",
    position: [4, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn5 = {
    color: "W",
    type: "pawn",
    position: [5, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn6 = {
    color: "W",
    type: "pawn",
    position: [6, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn7 = {
    color: "W",
    type: "pawn",
    position: [7, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn8 = {
    color: "W",
    type: "pawn",
    position: [8, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

// BLACK

let BRook1 = {
    color: "B",
    type: "rook",
    position: [1, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_tour.svg",
}

let BRook2 = {
    color: "B",
    type: "rook",
    position: [8, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_tour.svg",
}  

let BPony1 = {
    color: "B",
    type: "pony",
    position: [2, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_poney.svg",
}

let BPony2 = {
    color: "B",
    type: "pony",
    position: [7, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_poney.svg",
}

let BBishop1 = {
    color: "B",
    type: "bishop",
    position: [3, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_fou.svg",
}

let BBishop2 = {
    color: "B",
    type: "bishop",
    position: [6, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_fou.svg",
}

let BQueen = {
    color: "B",
    type: "queen",
    position: [4, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_dame.svg",
}

let BKing = {
    color: "B",
    type: "king",
    position: [5, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_king.svg",
}

let BPawn1 = {
    color: "B",
    type: "pawn",
    position: [1, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn2 = {
    color: "B",
    type: "pawn",
    position: [2, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}
let BPawn3 = {
    color: "B",
    type: "pawn",
    position: [3, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn4 = {
    color: "B",
    type: "pawn",
    position: [4, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn5 = {
    color: "B",
    type: "pawn",
    position: [5, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn6 = {
    color: "B",
    type: "pawn",
    position: [6, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn7 = {
    color: "B",
    type: "pawn",
    position: [7, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn8 = {
    color: "B",
    type: "pawn",
    position: [8, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}


let a = [WRook1, WPawn1, "x", "x", "x", "x", BPawn1, BRook1]
let b = [WPony1, WPawn2, "x", "x", "x", "x", BPawn2, BPony1]                              
let c = [WBishop1, WPawn3, "x", "x", "x", "x", BPawn3, BBishop1]
let d = [WQueen, WPawn4, "x", "x", "x", "x", BPawn4, BQueen]
let e = [WKing, WPawn5, "x", "x", "x", "x", BPawn5, BKing]
let f = [WBishop2, WPawn6, "x", "x", "x", "x", BPawn6, BBishop2]
let g = [WPony2, WPawn7, "x", "x", "x", "x", BPawn7, BPony2]
let h = [WRook2, WPawn8, "x", "x", "x", "x", BPawn8, BRook2]
let board = [a, b, c, d, e, f, g, h]

function Init(){
    for (let i=1; i<=8; i++){
        for (let j=1; j<=8; j++){
            let aff = document.getElementById(`${i}${j}`)
            if (board[i - 1][j - 1] != "x"){
                aff.src = board[i - 1][j - 1].chemin
            }
        }
    }
}

Init()

// Fonction Jeu

let Moves = []
let LegalMoves = []

function ReturnId(id){
    Moves.push(id)
    Play()
}

let position = []
let turn = "W"
function Play(){
    if (Moves.length == 1){

        if (board[Moves[0][0] - 1][Moves[0][1] - 1] != "x" && turn == board[Moves[0][0] - 1][Moves[0][1] - 1].color){

            if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "pawn"){
                MovePawn(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "rook"){
                MoveRook(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "bishop"){
                MoveBishop(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }
                
            
                
                
                
                // CONTINUER ICI
                                                                 // ADAPTER LE MOVE EN FONCTION DU
                                                                 // TYPE DU PION ---> BOSSER SUR FONCTIONS PIONS
        // PAS OUBLIER --> CALCULER SI ECHEC ETC ...


        }else{
            Moves = []
        }

    }else if(Moves.length == 2){                          
        if (LegalMoves.includes(`${Moves[1][0] - 1}${Moves[1][1] - 1}`)){
            board[Moves[0][0] - 1][Moves[0][1] - 1].position = [`${Moves[1][0]}`, `${Moves[1][1]}`]
            board[Moves[0][0] - 1][Moves[0][1] - 1].AlreadyMoved = true
            
            board[Moves[1][0] - 1][Moves[1][1] - 1] = board[Moves[0][0] - 1][Moves[0][1] - 1]
            board[Moves[0][0] - 1][Moves[0][1] - 1] = "x"  // FAIRES CONDITIONS ET GERER SI
            console.log(board)                             // PION ADVERSE MANGER

            Moves = []
            LegalMoves = []
            Update()

        }else{
            if (board[Moves[1][0] - 1][Moves[1][1] - 1] == "x"){
                Moves = [Moves[0]]
                LegalMoves = []
                Play()
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].color == board[Moves[1][0] - 1][Moves[1][1] - 1].color){
                Moves = [Moves[1]]
                LegalMoves = []
                Play()
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].color != board[Moves[1][0] - 1][Moves[1][1] - 1].color){
                Moves = [Moves[0]]
                LegalMoves = []
                Play()
            }
        }
    }
}






// fonction de calcul des pieces (begin)


function MovePawn(pawn){
    let xpawn_tab = pawn.position[0] - 1
    let ypawn_tab = pawn.position[1] - 1

    if (pawn.color == "W"){
        if (board[xpawn_tab][ypawn_tab + 1] == "x"){
            LegalMoves.push(`${xpawn_tab}${ypawn_tab + 1}`)
    
            if (board[xpawn_tab][ypawn_tab].AlreadyMoved == false && board[xpawn_tab][ypawn_tab + 2] == "x"){
                LegalMoves.push(`${xpawn_tab}${ypawn_tab + 2}`)
            }
        }
    
        if (xpawn_tab != 7 && board[xpawn_tab + 1][ypawn_tab + 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab + 1][ypawn_tab + 1].color){
            LegalMoves.push(`${xpawn_tab + 1}${ypawn_tab + 1}`)
        }
    
        if (xpawn_tab != 0 && board[xpawn_tab - 1][ypawn_tab + 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab - 1][ypawn_tab + 1].color){
            LegalMoves.push(`${xpawn_tab - 1}${ypawn_tab + 1}`)
        }

    }else if (pawn.color == "B"){
        if (board[xpawn_tab][ypawn_tab - 1] == "x"){
            LegalMoves.push(`${xpawn_tab}${ypawn_tab - 1}`)
    
            if (board[xpawn_tab][ypawn_tab].AlreadyMoved == false && board[xpawn_tab][ypawn_tab - 2] == "x"){
                LegalMoves.push(`${xpawn_tab}${ypawn_tab - 2}`)
            }
        }
    
        if (xpawn_tab != 0 && board[xpawn_tab - 1][ypawn_tab - 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab - 1][ypawn_tab - 1].color){
            LegalMoves.push(`${xpawn_tab - 1}${ypawn_tab - 1}`)
        }
    
        if (xpawn_tab != 7 && board[xpawn_tab + 1][ypawn_tab - 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab + 1][ypawn_tab - 1].color){
            LegalMoves.push(`${xpawn_tab + 1}${ypawn_tab - 1}`)
        }
    }
}   

function MoveRook(rook){
    let xrook_tab = rook.position[0] - 1
    let yrook_tab = rook.position[1] - 1
    
    if (yrook_tab != 7){
        for (let a=yrook_tab + 1; a<=7; a++){
            if (board[xrook_tab][a] == "x"){
                LegalMoves.push(`${xrook_tab}${a}`)
            }else if (board[xrook_tab][a].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${xrook_tab}${a}`)
                break
            }else if (board[xrook_tab][a].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }

    if (yrook_tab != 0){
        for (let b=yrook_tab - 1; b>=0; b--){
            if (board[xrook_tab][b] == "x"){
                LegalMoves.push(`${xrook_tab}${b}`)
            }else if (board[xrook_tab][b].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${xrook_tab}${b}`)
                break
            }else if (board[xrook_tab][b].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }

    if (xrook_tab != 7){
        for (let c=xrook_tab + 1; c<=7; c++){
            if (board[c][yrook_tab] == "x"){
                LegalMoves.push(`${c}${yrook_tab}`)
            }else if (board[c][yrook_tab].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${c}${yrook_tab}`)
                break
            }else if (board[c][yrook_tab].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }

    if (xrook_tab != 0){
        for (let d=xrook_tab - 1; d>=0; d--){
            if (board[d][yrook_tab] == "x"){
                LegalMoves.push(`${d}${yrook_tab}`)
            }else if (board[d][yrook_tab].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${d}${yrook_tab}`)
                break
            }else if (board[d][yrook_tab].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }
}

function MoveBishop(bishop){
    let xbishop_tab = bishop.position[0] - 1
    let ybishop_tab = bishop.position[1] - 1

    if (xbishop_tab != 7 && ybishop_tab != 7){
        for (let a=xbishop_tab + 1, b=ybishop_tab + 1; a<=7 && b<=7; a++, b++){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    if (xbishop_tab != 0 && ybishop_tab != 0){
        for (let a=xbishop_tab - 1, b=ybishop_tab - 1; a>=0 && b>=0; a--, b--){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    if (xbishop_tab != 0 && ybishop_tab != 7){
        for (let a=xbishop_tab - 1, b=ybishop_tab + 1; a>=0 && b<=7; a--, b++){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    if (xbishop_tab != 7 && ybishop_tab != 0){
        for (let a=xbishop_tab + 1, b=ybishop_tab - 1; a<=7 && b>=0; a++, b--){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    console.log(LegalMoves)
} 


// CONTINUER LA FAIRE MOVE PONEY

//SAVOIR QUAND INTRODUIRE FONCTION QUI CALCUL ECHEC







// fonction de calcul des pieces (end)


function Update(){
    for (let i=1; i<=8; i++){
        for (let j=1; j<=8; j++){
            let aff = document.getElementById(`${i}${j}`)
            if (board[i - 1][j - 1] != "x"){
                aff.src = board[i - 1][j - 1].chemin
            }else{
                aff.src = ""
            }
        }
    }

    if (turn == "W"){
        turn = "B"
    }else if (turn == "B"){
        turn = "W"
    }
}