// WHITE

let WRook1 = {
    color: "W",
    type: "rook",
    position: [1, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_tour.svg",
}

let WRook2 = {
    color: "W",
    type: "rook",
    position: [8, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_tour.svg",
}  

let WPony1 = {
    color: "W",
    type: "pony",
    position: [2, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_poney.svg",
}

let WPony2 = {
    color: "W",
    type: "pony",
    position: [7, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_poney.svg",
}

let WBishop1 = {
    color: "W",
    type: "bishop",
    position: [3, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_fou.svg",
}

let WBishop2 = {
    color: "W",
    type: "bishop",
    position: [6, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_fou.svg",
}

let WQueen = {
    color: "W",
    type: "queen",
    position: [4, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_dame.svg",
}

let WKing = {
    color: "W",
    type: "king",
    position: [5, 1],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_king.svg",
}

let WPawn1 = {
    color: "W",
    type: "pawn",
    position: [1, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn2 = {
    color: "W",
    type: "pawn",
    position: [2, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}
let WPawn3 = {
    color: "W",
    type: "pawn",
    position: [3, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn4 = {
    color: "W",
    type: "pawn",
    position: [4, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn5 = {
    color: "W",
    type: "pawn",
    position: [5, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn6 = {
    color: "W",
    type: "pawn",
    position: [6, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn7 = {
    color: "W",
    type: "pawn",
    position: [7, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

let WPawn8 = {
    color: "W",
    type: "pawn",
    position: [8, 2],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/white_pion.svg",
}

// BLACK

let BRook1 = {
    color: "B",
    type: "rook",
    position: [1, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_tour.svg",
}

let BRook2 = {
    color: "B",
    type: "rook",
    position: [8, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_tour.svg",
}  

let BPony1 = {
    color: "B",
    type: "pony",
    position: [2, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_poney.svg",
}

let BPony2 = {
    color: "B",
    type: "pony",
    position: [7, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_poney.svg",
}

let BBishop1 = {
    color: "B",
    type: "bishop",
    position: [3, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_fou.svg",
}

let BBishop2 = {
    color: "B",
    type: "bishop",
    position: [6, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_fou.svg",
}

let BQueen = {
    color: "B",
    type: "queen",
    position: [4, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_dame.svg",
}

let BKing = {
    color: "B",
    type: "king",
    position: [5, 8],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_king.svg",
}

let BPawn1 = {
    color: "B",
    type: "pawn",
    position: [1, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn2 = {
    color: "B",
    type: "pawn",
    position: [2, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}
let BPawn3 = {
    color: "B",
    type: "pawn",
    position: [3, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn4 = {
    color: "B",
    type: "pawn",
    position: [4, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn5 = {
    color: "B",
    type: "pawn",
    position: [5, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn6 = {
    color: "B",
    type: "pawn",
    position: [6, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn7 = {
    color: "B",
    type: "pawn",
    position: [7, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}

let BPawn8 = {
    color: "B",
    type: "pawn",
    position: [8, 7],
    AlreadyMoved: false,
    Moves: [],
    chemin: "image/black_pion.svg",
}


let a = [WRook1, WPawn1, "x", "x", "x", "x", BPawn1, BRook1]
let b = [WPony1, WPawn2, "x", "x", "x", "x", BPawn2, BPony1]                              
let c = [WBishop1, WPawn3, "x", "x", "x", "x", BPawn3, BBishop1]
let d = [WQueen, WPawn4, "x", "x", "x", "x", BPawn4, BQueen]
let e = [WKing, WPawn5, "x", "x", "x", "x", BPawn5, BKing]
let f = [WBishop2, WPawn6, "x", "x", "x", "x", BPawn6, BBishop2]
let g = [WPony2, WPawn7, "x", "x", "x", "x", BPawn7, BPony2]
let h = [WRook2, WPawn8, "x", "x", "x", "x", BPawn8, BRook2]
let board = [a, b, c, d, e, f, g, h]

function Init(){
    for (let i=1; i<=8; i++){
        for (let j=1; j<=8; j++){
            let aff = document.getElementById(`${i}${j}`)
            if (board[i - 1][j - 1] != "x"){
                aff.src = board[i - 1][j - 1].chemin
            }
        }
    }
}

Init()

// Fonction Jeu

let Moves = []
let LegalMoves = []

function ReturnId(id){
    Moves.push(id)
    Play()
}

let position = []
let turn = "W"
let PriseEnPassant = {legal: false, color: undefined, position: undefined}
let MoveRoque = []
function Play(){
    if (Moves.length == 1){

        if (board[Moves[0][0] - 1][Moves[0][1] - 1] != "x" && turn == board[Moves[0][0] - 1][Moves[0][1] - 1].color){

             // Laisser echec la (il supprime les data de legal mouv qui servent après)
            if (turn == "W"){
                Echec(WKing.position[0] - 1, WKing.position[1] - 1)
            }else if (turn == "B"){                                            
                Echec(BKing.position[0] - 1, BKing.position[1] - 1)
            }  
            

            if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "pawn"){
                MovePawn(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "rook"){
                MoveRook(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "bishop"){
                MoveBishop(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "pony"){
                MovePony(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "queen"){
                MoveQueen(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "king"){
                MoveKing(board[Moves[0][0] - 1][Moves[0][1] - 1])
                Roque(board[Moves[0][0] - 1][Moves[0][1] - 1])
            }
            

            // Continuer la fonction echec ici (Faire un plan sur feuilles avant) --> sinon reprendre idée en cours
            if (echec == true){

                // VERIFIER SI PIECE QUI MET EN ECHEC PEUT ETRE MANGER
                /*for (let i in LegalMoves){
                    for (let j in PositionEchec){
                        if (LegalMoves[i][0] == PositionEchec[j].position[0] - 1 && LegalMoves[i][1] == PositionEchec[j].position[1] - 1){
                            LegalMoves = [`${LegalMoves[i]}`]
                            console.log(LegalMoves)
                        }
                    }
                }*/

                

                // VERIFIER SI ON PEUT DEPLACER UN PION QUI ANNULERA L'ECHEC

                // ------>
                
                // Sinon si ds tt les cas echec alors echec et math


                // FAIRE UNE FONCTION COURTE QUI REGARDE SI LE MOUVEMENT D UN PION ALLIE METS EN ECHEC
            }else if (echec == false){
                for (p in LegalMoves){}
            }
            
            

        }else{
            Moves = []
        }

    }else if(Moves.length == 2){                          
        if (LegalMoves.includes(`${Moves[1][0] - 1}${Moves[1][1] - 1}`)){

            // Execution Prise en passant

            if (PriseEnPassant.legal == true && board[Moves[0][0] - 1][Moves[0][1] - 1].type == "pawn" && PriseEnPassant.position[1] == Moves[1][1] - 1 && PriseEnPassant.position[0] == Moves[1][0] - 1){
                if (board[Moves[0][0] - 1][Moves[0][1] - 1].color == "W"){
                    board[PriseEnPassant.position[0]][PriseEnPassant.position[1] - 1] = "x"
                }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].color == "B"){
                    board[PriseEnPassant.position[0]][PriseEnPassant.position[1] + 1] = "x"
                }
            }

            // Execution Prise en passant (end)

            PriseEnPassant = {legal: false, color: undefined, position: undefined}

            // Activation PriseEnPassant

            if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "pawn" && board[Moves[0][0] - 1][Moves[0][1] - 1].AlreadyMoved == false){
                if (board[Moves[0][0] - 1][Moves[0][1] - 1].color == "W" && Moves[1][1] == 4){
                    PriseEnPassant.legal = true
                    PriseEnPassant.position = [Moves[1][0] - 1, 2]
                }else if(board[Moves[0][0] - 1][Moves[0][1] - 1].color == "B" && Moves[1][1] == 5){
                    PriseEnPassant.legal = true
                    PriseEnPassant.position = [Moves[1][0] - 1, 5]
                }
            }

            // Activation PriseEnPassant (end)

            // Roque moove rook

            if (board[Moves[0][0] - 1][Moves[0][1] - 1].type == "king"){
                if (Moves[0][0] - 0 == Moves[1][0] - 2){
                    board[Moves[0][0] - 0 + 2][Moves[0][1] - 1].position = [6, 1]
                    board[Moves[0][0] - 0 + 2][Moves[0][1] - 1].AlreadyMoved = true
                    board[5][Moves[0][1] - 1] = board[Moves[0][0] - 0 + 2][Moves[0][1] - 1]
                    board[Moves[0][0] - 0 + 2][Moves[0][1] - 1] = "x"
                }else if (Moves[0][0] - 0 == Moves[1][0] - 0 + 2){
                    board[Moves[0][0] - 5][Moves[0][1] - 1].position = [4, 1]
                    board[Moves[0][0] - 5][Moves[0][1] - 1].AlreadyMoved = true
                    board[3][Moves[0][1] - 1] = board[Moves[0][0] - 5][Moves[0][1] - 1]
                    board[Moves[0][0] - 5][Moves[0][1] - 1] = "x"
                }
            }

            // Roque moove rook (end)


            board[Moves[0][0] - 1][Moves[0][1] - 1].position = [`${Moves[1][0]}`, `${Moves[1][1]}`]
            board[Moves[0][0] - 1][Moves[0][1] - 1].AlreadyMoved = true
            
            board[Moves[1][0] - 1][Moves[1][1] - 1] = board[Moves[0][0] - 1][Moves[0][1] - 1]
            board[Moves[0][0] - 1][Moves[0][1] - 1] = "x"  // FAIRES CONDITIONS ET GERER SI
            console.log(board)                             // PION ADVERSE MANGER

            Moves = []
            LegalMoves = []
            Update()

        }else{
            if (board[Moves[1][0] - 1][Moves[1][1] - 1] == "x"){
                Moves = [Moves[0]]
                LegalMoves = []
                Play()
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].color == board[Moves[1][0] - 1][Moves[1][1] - 1].color){
                Moves = [Moves[1]]
                LegalMoves = []
                Play()
            }else if (board[Moves[0][0] - 1][Moves[0][1] - 1].color != board[Moves[1][0] - 1][Moves[1][1] - 1].color){
                Moves = [Moves[0]]
                LegalMoves = []
                Play()
            }
        }
    }
}


// fonction de calcul des pieces (begin)


function MovePawn(pawn){
    let xpawn_tab = pawn.position[0] - 1
    let ypawn_tab = pawn.position[1] - 1

    if (pawn.color == "W"){
        if (board[xpawn_tab][ypawn_tab + 1] == "x"){
            LegalMoves.push(`${xpawn_tab}${ypawn_tab + 1}`)
    
            if (board[xpawn_tab][ypawn_tab].AlreadyMoved == false && board[xpawn_tab][ypawn_tab + 2] == "x"){
                LegalMoves.push(`${xpawn_tab}${ypawn_tab + 2}`)
            }
        }
    
        if (xpawn_tab != 7 && board[xpawn_tab + 1][ypawn_tab + 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab + 1][ypawn_tab + 1].color){
            LegalMoves.push(`${xpawn_tab + 1}${ypawn_tab + 1}`)
        }
    
        if (xpawn_tab != 0 && board[xpawn_tab - 1][ypawn_tab + 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab - 1][ypawn_tab + 1].color){
            LegalMoves.push(`${xpawn_tab - 1}${ypawn_tab + 1}`)
        }

        if (PriseEnPassant.legal == true && ypawn_tab == PriseEnPassant.position[1] - 1){
            if (xpawn_tab == PriseEnPassant.position[0] + 1 || xpawn_tab == PriseEnPassant.position[0] - 1){
                LegalMoves.push(`${PriseEnPassant.position[0]}${PriseEnPassant.position[1]}`)
            }
        }

    }else if (pawn.color == "B"){
        if (board[xpawn_tab][ypawn_tab - 1] == "x"){
            LegalMoves.push(`${xpawn_tab}${ypawn_tab - 1}`)
    
            if (board[xpawn_tab][ypawn_tab].AlreadyMoved == false && board[xpawn_tab][ypawn_tab - 2] == "x"){
                LegalMoves.push(`${xpawn_tab}${ypawn_tab - 2}`)
            }
        }
    
        if (xpawn_tab != 0 && board[xpawn_tab - 1][ypawn_tab - 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab - 1][ypawn_tab - 1].color){
            LegalMoves.push(`${xpawn_tab - 1}${ypawn_tab - 1}`)
        }
    
        if (xpawn_tab != 7 && board[xpawn_tab + 1][ypawn_tab - 1] != "x" && board[xpawn_tab][ypawn_tab].color != board[xpawn_tab + 1][ypawn_tab - 1].color){
            LegalMoves.push(`${xpawn_tab + 1}${ypawn_tab - 1}`)
        }

        if (PriseEnPassant.legal == true && ypawn_tab == PriseEnPassant.position[1] + 1){
            if (xpawn_tab == PriseEnPassant.position[0] + 1 || xpawn_tab == PriseEnPassant.position[0] - 1){
                LegalMoves.push(`${PriseEnPassant.position[0]}${PriseEnPassant.position[1]}`)
            }
        }
    }
}   

function MoveRook(rook){
    let xrook_tab = rook.position[0] - 1
    let yrook_tab = rook.position[1] - 1
    
    if (yrook_tab != 7){
        for (let a=yrook_tab + 1; a<=7; a++){
            if (board[xrook_tab][a] == "x"){
                LegalMoves.push(`${xrook_tab}${a}`)
            }else if (board[xrook_tab][a].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${xrook_tab}${a}`)
                break
            }else if (board[xrook_tab][a].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }

    if (yrook_tab != 0){
        for (let b=yrook_tab - 1; b>=0; b--){
            if (board[xrook_tab][b] == "x"){
                LegalMoves.push(`${xrook_tab}${b}`)
            }else if (board[xrook_tab][b].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${xrook_tab}${b}`)
                break
            }else if (board[xrook_tab][b].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }

    if (xrook_tab != 7){
        for (let c=xrook_tab + 1; c<=7; c++){
            if (board[c][yrook_tab] == "x"){
                LegalMoves.push(`${c}${yrook_tab}`)
            }else if (board[c][yrook_tab].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${c}${yrook_tab}`)
                break
            }else if (board[c][yrook_tab].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }

    if (xrook_tab != 0){
        for (let d=xrook_tab - 1; d>=0; d--){
            if (board[d][yrook_tab] == "x"){
                LegalMoves.push(`${d}${yrook_tab}`)
            }else if (board[d][yrook_tab].color != board[xrook_tab][yrook_tab].color){
                LegalMoves.push(`${d}${yrook_tab}`)
                break
            }else if (board[d][yrook_tab].color == board[xrook_tab][yrook_tab].color){
                break
            }
        }
    }
}

function MoveBishop(bishop){
    let xbishop_tab = bishop.position[0] - 1
    let ybishop_tab = bishop.position[1] - 1

    if (xbishop_tab != 7 && ybishop_tab != 7){
        for (let a=xbishop_tab + 1, b=ybishop_tab + 1; a<=7 && b<=7; a++, b++){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    if (xbishop_tab != 0 && ybishop_tab != 0){
        for (let a=xbishop_tab - 1, b=ybishop_tab - 1; a>=0 && b>=0; a--, b--){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    if (xbishop_tab != 0 && ybishop_tab != 7){
        for (let a=xbishop_tab - 1, b=ybishop_tab + 1; a>=0 && b<=7; a--, b++){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }

    if (xbishop_tab != 7 && ybishop_tab != 0){
        for (let a=xbishop_tab + 1, b=ybishop_tab - 1; a<=7 && b>=0; a++, b--){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xbishop_tab][ybishop_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xbishop_tab][ybishop_tab].color){
                break
            }
        }
    }
} 

function MovePony(pony){
    let xpony_tab = pony.position[0] - 1
    let ypony_tab = pony.position[1] - 1

    if (ypony_tab != 7 && ypony_tab != 6){
        if (xpony_tab != 0){
            if (board[xpony_tab - 1][ypony_tab + 2] == "x"){
                LegalMoves.push(`${xpony_tab - 1}${ypony_tab + 2}`)
            }else if (board[xpony_tab - 1][ypony_tab + 2].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab - 1}${ypony_tab + 2}`)
            }
        }

        if (xpony_tab != 7){
            if (board[xpony_tab + 1][ypony_tab + 2] == "x"){
                LegalMoves.push(`${xpony_tab + 1}${ypony_tab + 2}`)
            }else if (board[xpony_tab + 1][ypony_tab + 2].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab + 1}${ypony_tab + 2}`)
            }
        }
    }

    if (ypony_tab != 0 && ypony_tab != 1){
        if (xpony_tab != 0){
            if (board[xpony_tab - 1][ypony_tab - 2] == "x"){
                LegalMoves.push(`${xpony_tab - 1}${ypony_tab - 2}`)
            }else if (board[xpony_tab - 1][ypony_tab - 2].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab - 1}${ypony_tab - 2}`)
            }
        }

        if (xpony_tab != 7){
            if (board[xpony_tab + 1][ypony_tab - 2] == "x"){
                LegalMoves.push(`${xpony_tab + 1}${ypony_tab - 2}`)
            }else if (board[xpony_tab + 1][ypony_tab - 2].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab + 1}${ypony_tab - 2}`)
            }
        }
    }

    if (xpony_tab != 7 && xpony_tab != 6){
        if (ypony_tab != 0){
            if (board[xpony_tab + 2][ypony_tab - 1] == "x"){
                LegalMoves.push(`${xpony_tab + 2}${ypony_tab - 1}`)
            }else if (board[xpony_tab + 2][ypony_tab - 1].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab + 2}${ypony_tab - 1}`)
            }
        }

        if (ypony_tab != 7){
            if (board[xpony_tab + 2][ypony_tab + 1] == "x"){
                LegalMoves.push(`${xpony_tab + 2}${ypony_tab + 1}`)
            }else if (board[xpony_tab + 2][ypony_tab + 1].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab + 2}${ypony_tab + 1}`)
            }
        }
    }

    if (xpony_tab != 0 && xpony_tab != 1){
        if (ypony_tab != 0){
            if (board[xpony_tab - 2][ypony_tab - 1] == "x"){
                LegalMoves.push(`${xpony_tab - 2}${ypony_tab - 1}`)
            }else if (board[xpony_tab - 2][ypony_tab - 1].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab - 2}${ypony_tab - 1}`)
            }
        }

        if (ypony_tab != 7){
            if (board[xpony_tab - 2][ypony_tab + 1] == "x"){
                LegalMoves.push(`${xpony_tab - 2}${ypony_tab + 1}`)
            }else if (board[xpony_tab - 2][ypony_tab + 1].color != board[xpony_tab][ypony_tab].color){
                LegalMoves.push(`${xpony_tab - 2}${ypony_tab + 1}`)
            }
        }
    }
}

function MoveQueen(queen){
    let xqueen_tab = queen.position[0] - 1
    let yqueen_tab = queen.position[1] - 1

    // Moves horizontal et vertical
    if (yqueen_tab != 7){
        for (let a=yqueen_tab + 1; a<=7; a++){
            if (board[xqueen_tab][a] == "x"){
                LegalMoves.push(`${xqueen_tab}${a}`)
            }else if (board[xqueen_tab][a].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${xqueen_tab}${a}`)
                break
            }else if (board[xqueen_tab][a].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    if (yqueen_tab != 0){
        for (let b=yqueen_tab - 1; b>=0; b--){
            if (board[xqueen_tab][b] == "x"){
                LegalMoves.push(`${xqueen_tab}${b}`)
            }else if (board[xqueen_tab][b].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${xqueen_tab}${b}`)
                break
            }else if (board[xqueen_tab][b].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    if (xqueen_tab != 7){
        for (let c=xqueen_tab + 1; c<=7; c++){
            if (board[c][yqueen_tab] == "x"){
                LegalMoves.push(`${c}${yqueen_tab}`)
            }else if (board[c][yqueen_tab].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${c}${yqueen_tab}`)
                break
            }else if (board[c][yqueen_tab].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    if (xqueen_tab != 0){
        for (let d=xqueen_tab - 1; d>=0; d--){
            if (board[d][yqueen_tab] == "x"){
                LegalMoves.push(`${d}${yqueen_tab}`)
            }else if (board[d][yqueen_tab].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${d}${yqueen_tab}`)
                break
            }else if (board[d][yqueen_tab].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    // Moves diagonales

    if (xqueen_tab != 7 && yqueen_tab != 7){
        for (let a=xqueen_tab + 1, b=yqueen_tab + 1; a<=7 && b<=7; a++, b++){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    if (xqueen_tab != 0 && yqueen_tab != 0){
        for (let a=xqueen_tab - 1, b=yqueen_tab - 1; a>=0 && b>=0; a--, b--){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    if (xqueen_tab != 0 && yqueen_tab != 7){
        for (let a=xqueen_tab - 1, b=yqueen_tab + 1; a>=0 && b<=7; a--, b++){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }

    if (xqueen_tab != 7 && yqueen_tab != 0){
        for (let a=xqueen_tab + 1, b=yqueen_tab - 1; a<=7 && b>=0; a++, b--){
            if (board[a][b] == "x"){
                LegalMoves.push(`${a}${b}`)
            }else if (board[a][b].color != board[xqueen_tab][yqueen_tab].color){
                LegalMoves.push(`${a}${b}`)
                break
            }else if (board[a][b].color == board[xqueen_tab][yqueen_tab].color){
                break
            }
        }
    }
}

function MoveKing(king){
    let xking_tab = king.position[0] - 1
    let yking_tab = king.position[1] - 1

    // Horizontal et vertical
    if (xking_tab != 7){
        if (board[xking_tab + 1][yking_tab] == "x" || board[xking_tab + 1][yking_tab].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab + 1}${yking_tab}`)
        }
    }

    if (xking_tab != 0){
        if (board[xking_tab - 1][yking_tab] == "x" || board[xking_tab - 1][yking_tab].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab - 1}${yking_tab}`)
        }
    }

    if (yking_tab != 7){
        if (board[xking_tab][yking_tab + 1] == "x" || board[xking_tab][yking_tab + 1].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab}${yking_tab + 1}`)
        }
    }

    if (yking_tab != 0){
        if (board[xking_tab][yking_tab - 1] == "x" || board[xking_tab][yking_tab - 1].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab}${yking_tab - 1}`)
        }
    }

    // Diagonal

    if (xking_tab != 7 && yking_tab != 7){
        if (board[xking_tab + 1][yking_tab + 1] == "x" || board[xking_tab + 1][yking_tab + 1].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab + 1}${yking_tab + 1}`)
        }
    }

    if (xking_tab != 0 && yking_tab != 7){
        if (board[xking_tab - 1][yking_tab + 1] == "x" || board[xking_tab - 1][yking_tab + 1].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab - 1}${yking_tab + 1}`)
        }
    }

    if (xking_tab != 7 && yking_tab != 0){
        if (board[xking_tab + 1][yking_tab - 1] == "x" || board[xking_tab + 1][yking_tab - 1].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab + 1}${yking_tab - 1}`)
        }
    }

    if (xking_tab != 0 && yking_tab != 0){
        if (board[xking_tab - 1][yking_tab - 1] == "x" || board[xking_tab - 1][yking_tab - 1].color != board[xking_tab][yking_tab].color){
            LegalMoves.push(`${xking_tab - 1}${yking_tab - 1}`)
        }
    }
}

function Roque(king){
    let xking_tab = king.position[0] - 1
    let yking_tab = king.position[1] - 1

    if (king.AlreadyMoved == false){
        if (board[xking_tab + 1][yking_tab] == "x" && board[xking_tab + 2][yking_tab] == "x" && board[xking_tab + 3][yking_tab].type == "rook" && board[xking_tab + 3][yking_tab].AlreadyMoved == false){
            LegalMoves.push(`${xking_tab + 2}${yking_tab}`)
            MoveRoque.push(`${xking_tab + 1}${yking_tab}`)
        }

        if (board[xking_tab - 1][yking_tab] == "x" && board[xking_tab - 2][yking_tab] == "x" && board[xking_tab - 3][yking_tab] == "x" && board[xking_tab - 4][yking_tab].type == "rook" && board[xking_tab - 4][yking_tab].AlreadyMoved == false){
            LegalMoves.push(`${xking_tab - 2}${yking_tab}`)
            MoveRoque.push(`${xking_tab - 1}${yking_tab}`)
        }
    }
}

// ECHEC

/*function EchecAndMath(){
    function CanTake(){
        for (let i in LegalMoves){
            for (let j in PositionEchec){
                if (LegalMoves[i][0] == PositionEchec[j].position[0] - 1 && LegalMoves[i][1] == PositionEchec[j].position[1] - 1){
                    LegalMoves = [`${LegalMoves[i]}`]
                    console.log(LegalMoves)
                }
            }
        }
    }

    for (let i=0; i<8; i++){
        for (let j=0; j<8; j++){
            if (board[i][j].color == turn){
                if (board[i][j].type == "pawn"){
                    MovePawn(board[i][j])
                }
            }
        }
    }


}*/


let echec = false
let PositionEchec = []
function Echec(xking, yking){

    function AddEchec (i, j) {
        for (let k in LegalMoves){
            if (LegalMoves[k] == `${xking}${yking}`){
                PositionEchec.push(board[i][j])
                echec = true
                console.log(PositionEchec)
            }
        }
        LegalMoves = []
    }

    for (let i=0; i<8; i++){
        for (let j=0; j<8; j++){
            if (board[i][j].color != turn){
                if (board[i][j].type == "pawn"){
                    MovePawn(board[i][j])
                    AddEchec(i, j)
                }else if (board[i][j].type == "rook"){
                    MoveRook(board[i][j])
                    AddEchec(i, j)
                }else if (board[i][j].type == "bishop"){
                    MoveBishop(board[i][j])
                    AddEchec(i, j)
                }else if (board[i][j].type == "pony"){
                    MovePony(board[i][j])
                    AddEchec(i, j)
                }else if (board[i][j].type == "queen"){
                    MoveQueen(board[i][j])
                    AddEchec(i, j)
                }else if (board[i][j].type == "king"){
                    MoveKing(board[i][j])
                    AddEchec(i, j) 
                    Roque(board[i][j])
                    AddEchec(i, j)
                }
            }
        }
    }

    if (echec == true){
        let MoveStopEchec = []


        // LA PIECE QUI MET EN ECHEC PEUT ELLE ETRE MANGER ?
        /*function CanTake(){
            for (let i in LegalMoves){
                for (let j in PositionEchec){
                    if (LegalMoves[i][0] == PositionEchec[j].position[0] - 1 && LegalMoves[i][1] == PositionEchec[j].position[1] - 1){
                        MoveStopEchec.push(`${LegalMoves[i]}`)
                    }
                }
            }

            LegalMoves = []
        }
        
        for (let x=0; x<8; x++){
            for (let y=0; y<8; y++){
                if (board[x][y].color == turn){
                    if (board[x][y].type == "pawn"){
                        MovePawn(board[x][y])
                        CanTake()
                    }else if (board[x][y].type == "rook"){
                        MoveRook(board[x][y])
                        CanTake()
                    }else if (board[x][y].type == "bishop"){
                        MoveBishop(board[x][y])
                        CanTake()
                    }else if (board[x][y].type == "pony"){
                        MovePony(board[x][y])
                        CanTake()
                    }else if (board[x][y].type == "queen"){
                        MoveQueen(board[x][y])
                        CanTake()
                    }else if (board[x][y].type == "king"){
                        MoveKing(board[x][y])
                        CanTake() 
                        Roque(board[x][y])
                        CanTake()
                    }
                }
            }
        }*/

        // UN PION DE LA COULEUR DU ROI EN ECHEC PEUT IL BLOQUER ATTAQUE DE LA PIECE QUI MET EN ECHEC ?

        function CanBlock(piece){
            let PieceType = piece.type
            let xPieceTab = piece.position[0] - 1
            let yPieceTab = piece.position[1] - 1
            let CaseCanBlock = [...LegalMoves]
            for (let t in CaseCanBlock){
                console.log(CaseCanBlock[t], 5555555, LegalMoves)
                let xCase = CaseCanBlock[t][0]
                let yCase = CaseCanBlock[t][1]
                let Case = board[xCase][yCase]

                board[xCase][yCase] = board[xPieceTab][yPieceTab]
                board[xPieceTab][yPieceTab] = "x"

                echec = false
                
                for (let i=0; i<8; i++){
                    for (let j=0; j<8; j++){
                        if (board[i][j].color != turn){
                            if (board[i][j].type == "pawn"){
                                MovePawn(board[i][j])
                                AddEchec(i, j)
                            }else if (board[i][j].type == "rook"){
                                MoveRook(board[i][j])
                                AddEchec(i, j)
                            }else if (board[i][j].type == "bishop"){
                                MoveBishop(board[i][j])
                                AddEchec(i, j)
                            }else if (board[i][j].type == "pony"){
                                MovePony(board[i][j])
                                AddEchec(i, j)
                            }else if (board[i][j].type == "queen"){
                                MoveQueen(board[i][j])
                                AddEchec(i, j)
                            }else if (board[i][j].type == "king"){
                                MoveKing(board[i][j])
                                AddEchec(i, j) 
                                Roque(board[i][j])
                                AddEchec(i, j)
                            }
                        }
                    }
                }

                if (echec == false){
                    MoveStopEchec.push(`${xCase}${yCase}`) //MoveStopEchec.push(`${xCase}${yCase}, piece`)
                }

                board[xCase][yCase] = Case
                board[xPieceTab][yPieceTab] = piece
                console.log("yeah", MoveStopEchec)
            }

            LegalMoves = []

            // CONTINUER ICI FAIRE FUNCTION QUI REGARDE SI ATTACK PEUT ETRE BLOQUER
            // REGLER BUG ROI PEUT CONTRER ECHEC SANS ETRE EN ECHEC
        }

        for (let x=0; x<8; x++){
            for (let y=0; y<8; y++){
                if (board[x][y].color == turn){
                    if (board[x][y].type == "pawn"){
                        MovePawn(board[x][y])
                        CanBlock(board[x][y])
                    }else if (board[x][y].type == "rook"){
                        MoveRook(board[x][y])
                        CanBlock(board[x][y])
                    }else if (board[x][y].type == "bishop"){
                        MoveBishop(board[x][y])
                        CanBlock(board[x][y])
                    }else if (board[x][y].type == "pony"){
                        MovePony(board[x][y])
                        CanBlock(board[x][y])
                    }else if (board[x][y].type == "queen"){
                        MoveQueen(board[x][y])
                        CanBlock(board[x][y])
                    }else if (board[x][y].type == "king"){
                        MoveKing(board[x][y])
                        CanBlock(board[x][y]) 
                        Roque(board[x][y])
                        CanBlock(board[x][y])
                    }
                }
            }
        }


        // SI AUCUN MOVE QUI PEUT STOPPER  ECHEC ALORS ECHEC ET MATH

        console.log(MoveStopEchec, "final")

        if (MoveStopEchec.length == 0){
            console.log("ECHEC ET MATH DANS TA GEULE")
        }

        LegalMoves = []
    }
}  

     // CONTINUER LA / ETAPES SUR FICHE 




// REPARER BUG DUCPLICA








// fonction de calcul des pieces (end)


function Update(){
    for (let i=1; i<=8; i++){
        for (let j=1; j<=8; j++){
            let aff = document.getElementById(`${i}${j}`)
            if (board[i - 1][j - 1] != "x"){
                aff.src = board[i - 1][j - 1].chemin
            }else{
                aff.src = ""
            }
        }
    }

    if (turn == "W"){
        turn = "B"
    }else if (turn == "B"){
        turn = "W"
    }
}